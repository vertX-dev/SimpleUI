<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Draggable Image on Grid</title>
  <style>
    /* Reset */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      font-family: sans-serif;
    }
    /* Container layout: grid (80%) + sidebar (20%) */
    body {
      display: flex;
    }
    /* The grid container on the left */
    .grid-container {
      width: 80%;
      height: 100vh;
      position: relative; /* needed for absolute positioning of dropped images */
      background-color: #fafafa;
      overflow: auto;
      /* Create a 100x100 grid of 16px cells */
      display: grid;
      grid-template-columns: repeat(15, 16px);
      grid-template-rows: repeat(15, 16px);
      /* Optional: a light border for each cell */
      background-image: 
        linear-gradient(to right, #ccc 1px, transparent 1px),
        linear-gradient(to bottom, #ccc 1px, transparent 1px);
      background-size: 16px 16px;
    }
    /* The sidebar on the right */
    .sidebar {
      width: 20%;
      padding: 10px;
      background-color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* Draggable image style */
    .draggable-image {
      width: 256px;
      height: 256px;
      cursor: move;
      border: 2px solid #888;
      margin-bottom: 20px;
      user-select: none;
    }
    /* Upload button style */
    .upload-button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Left: the grid container -->
  <div class="grid-container" id="grid">
    <!-- We use a CSS background grid so no need to create 10,000 DOM cells -->
  </div>

  <!-- Right: the sidebar -->
  <div class="sidebar">
    <!-- Draggable image (default placeholder) -->
    <img src="https://via.placeholder.com/256" 
         alt="Draggable" 
         id="draggable" 
         class="draggable-image">
    <!-- Hidden file input and button for uploading a new image -->
    <input type="file" id="fileInput" accept="image/*" style="display: none;">
    <button class="upload-button" id="uploadBtn">Upload Image</button>
  </div>

  <script>
    // Global variable to store the element being dragged.
    let draggedElement = null;
    
    // Get elements
    const grid = document.getElementById('grid');
    const sidebarImg = document.getElementById('draggable');
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('fileInput');

    // Enable dragging on the sidebar image.
    sidebarImg.draggable = true;
    sidebarImg.addEventListener('dragstart', function(e) {
      draggedElement = this;
      // Optionally, you can set a custom drag image.
      e.dataTransfer.setData('text/plain', 'sidebar');
    });

    // When starting a drag from an image already on the grid,
    // store that image so we know to reposition it (rather than clone).
    function addGridImageDragListeners(img) {
      img.addEventListener('dragstart', function(e) {
        draggedElement = this;
        e.dataTransfer.setData('text/plain', 'grid');
        // Set a drag image centered on the image.
        e.dataTransfer.setDragImage(this, 128, 128);
      });
    }

    // Allow drop on the grid.
    grid.addEventListener('dragover', function(e) {
      e.preventDefault();
    });

    grid.addEventListener('drop', function(e) {
      e.preventDefault();
      const rect = grid.getBoundingClientRect();
      // Calculate drop position relative to grid
      let x = e.clientX - rect.left;
      let y = e.clientY - rect.top;
      // Snap to grid (each cell is 16px)
      x = Math.floor(x / 16) * 16;
      y = Math.floor(y / 16) * 16;
      
      // If the dragged element is already in the grid, reposition it.
      if (draggedElement && grid.contains(draggedElement)) {
        draggedElement.style.left = x + 'px';
        draggedElement.style.top = y + 'px';
      } else if (draggedElement) {
        // Otherwise, clone the sidebar image into the grid.
        const img = document.createElement('img');
        img.src = draggedElement.src;
        img.style.position = 'absolute';
        img.style.left = x + 'px';
        img.style.top = y + 'px';
        img.style.width = '256px';
        img.style.height = '256px';
        img.classList.add('draggable-image');
        img.draggable = true;
        addGridImageDragListeners(img);
        grid.appendChild(img);
      }
      draggedElement = null;
    });

    // File upload functionality.
    uploadBtn.addEventListener('click', function() {
      fileInput.click();
    });

    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if(file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          // Update the sidebar image with the uploaded image.
          sidebarImg.src = event.target.result;
        }
        reader.readAsDataURL(file);
      }
    });
  </script>
</body>
</html>